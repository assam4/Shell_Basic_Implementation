MAKEFLAGS		= --no-print-directory

NAME			= minishell

SRC				=	./environment/environment.c \
					./environment/utils.c \
					./runtime/expand_env.c \
					./runtime/expantion_utils.c \
					./runtime/redirections.c \
					./runtime/command_utils.c \
					./runtime/executor.c \
					./runtime/expantion.c \
					./runtime/execute_command.c \
					./shell/utils.c \
					./shell/shell.c \
					./shell/exit_status.c \
					./syntax_a/here_doc.c \
					./syntax_a/analyze.c \
					./syntax_a/utils.c \
					./library/get_next_line/get_next_line.c \
					./lexical_a/token_setters.c \
					./lexical_a/token_mgmt.c \
					./builtins/cd.c \
					./builtins/echo.c \
					./builtins/unset.c \
					./builtins/export.c \
					./builtins/exit.c \
					./builtins/cd_utils.c \
					./builtins/env.c \
					./builtins/pwd.c \
					./builtins/builtin.c \
					./optimization/getters.c \
					./optimization/blossom.c \
					./optimization/cmd_optimize.c \
					./optimization/hdoc_optimize.c

INC				=	-I ./environment \
					-I ./runtime \
					-I ./shell \
					-I ./syntax_a \
					-I ./library \
					-I ./library/libft \
					-I ./library/get_next_line \
					-I ./lexical_a \
					-I ./builtins \
					-I ./optimization

HEADERS			=	./environment/environment.h \
					./runtime/executor.h \
					./shell/shell.h \
					./syntax_a/syntax.h \
					./library/libft/libft.h \
					./library/get_next_line/get_next_line.h \
					./lexical_a/token.h \
					./builtins/builtin.h \
					./optimization/tree.h


BUILD_DIR		= ./.build
OBJ				= $(SRC:%.c=$(BUILD_DIR)/%.o)

FLAGS			= -Wall -Wextra -Werror
RLFLAGS			= -lreadline

LIBFT_DIR		= ./library/libft
LIBFT			= -L$(LIBFT_DIR) -lft



GREEN			= \033[38;2;109;173;126m
DARK_GREEN		= \033[38;2;63;166;90m
YELLOW			= \033[33m
RED				= \033[31m
RESET			= \033[0m
BLUE			= \033[34m

all: build lib $(NAME)

$(BUILD_DIR)/%.o: %.c $(HEADERS) Makefile
	@mkdir -p $(dir $@)
	@$(CC) $(FLAGS) $(INC) -c $< -o $@
	@bash -c '\
		cols=$$(tput cols); \
		lines=6; \
		chars="01"; \
		for ((i=0; i<$$lines; i++)); do \
			line=""; \
			for ((j=0; j<$$cols; j++)); do \
				if (( RANDOM % 5 == 0 )); then \
					c=$${chars:RANDOM%$${#chars}:1}; \
					line+="$(GREEN)$$c"; \
				else \
					line+=" "; \
				fi; \
			done; \
			echo -e "$$line"; \
			sleep 0.01; \
		done'

$(NAME): $(OBJ) $(LIBFT_DIR)/libft.a
	@cc $(FLAGS) $(INC) $(OBJ) $(RLFLAGS) -o $(NAME) $(LIBFT_DIR)/libft.a

		@printf "$(GREEN)\n\n\
				==:+=:=*%%@*@%%%%%%%%#%%%%%%@%%%%*########*####*###*##%%##%%###%%##########*#####**##%%####%%#%%%%%%#%%#===%%%%%%%%%%%%*@@%%%%\n\
				==:==:+%%%%**%%%%%%%%%%%%#%%%%@#%%###%%#########%%*########%%%%@@@@@%%############%%*##**###*#%%##%%##%%#===%%%%%%#%%%%**#%%%%\n\
				++++*##%%#+++#%%####%%#%%######*####*#*######*%%@@@@@@@@@@@@@@%%%%##########*############*%%%%%%%%%%%%%%*@%%##**%%%%\n\
				**%%%%%%%%@%%#+==#%%#%%%%#%%#%%*#####*###%%#######%%@@@@@@@@@@@@@@@@@@@@%%%%#####*%%*##%%##*###%%%%##%%%%%%%%%%@%%*#%%%%%%%%%%%%%%\n\
				**%%%%%%@*%%#---#%%%%%%%%%%%%######*#+*#*##%%*##%%@@@@@@@@@@@@@@@@@@@@@@@@%%####*####%%#**#%%#%%###%%%%%%%%%%%%%%%%%%%%##**%%%%\n\
				%%%%%%%%@@+%%#=--###%%%%%%#*#*#*###****##***@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*##%%##*###*###%%#%%#%%%%%%%%%%%%%%**%%%%%%%%#%%%%\n\
				##@%%%%%%%%%%%%%%%%%%%%%%###%%%%*#*###*######*#*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%###*####*######%%#%%%%%%%%%%%%%%**%%%%+**%%%%\n\
				#%%@@%%#*#%%%%%%%%####%%#%%%%#*%%##*******##@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%*#*%%#########%%%%#%%%%%%%%%%%%%%%%#@%%%%*%%@@\n\
				%%%%@%%@@*%%%%%%%%%%#*###*#######*#*##*#*#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%*##########*%%%%%%%%%%%%%%%%%%%%%%*+%%%%%%#%%@@\n\
				#%%@%%@@#%%%%%%%%%%#==##%%%%##*###*####*#*%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*#**#%%*#####%%##%%%%%%%%%%%%%%#==#%%%%*%%@%%\n\
				#%%@%%@@#%%%%@@#%%@@#$(DARK_GREEN)    ███▄ ▄███▓██▓███▄    █ ██▓ ██████ ██░ ██▓█████ ██▓    ██▓    $(GREEN)#####%%#%%%%%%%%%%%%%%#@@#\n\
				#%%@%%@@#%%%%@@#%%@@#$(DARK_GREEN)   ▓██▒▀█▀ ██▓██▒██ ▀█   █▓██▒██    ▒▓██░ ██▓█   ▀▓██▒   ▓██▒    $(GREEN)#####%%#%%%%%%%%%%%%%%#@@#\n\
				#%%@%%@@#%%%%@@#%%@@#$(DARK_GREEN)   ▓██    ▓██▒██▓██  ▀█ ██▒██░ ▓██▄  ▒██▀▀██▒███  ▒██░   ▒██░    $(GREEN)#####%%#%%%%%%%%%%%%%%#@@#\n\
				#%%@%%@@#%%%%@@#%%@@#$(DARK_GREEN)   ▒██    ▒██░██▓██▒  ▐▌██░██░ ▒   ██░▓█ ░██▒▓█  ▄▒██░   ▒██░    $(GREEN)#####%%#%%%%%%%%%%%%%%#@@#\n\
				#%%@%%@@#%%%%@@#%%@@#$(DARK_GREEN)   ▒██▒   ░██░██▒██░   ▓██░██▒██████▒░▓█▒░██░▒████░██████░██████▒$(GREEN)#####%%#%%%%%%%%%%%%%%#@@#\n\
				%%@%%#%%%%%%%%#*####**##*####*#****#*#*##@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%##*#*#*#*####*%%+####%%%%%%%%%%%%#%%%%%%#%%%%\n\
				##%%*%%#%%####%%#%%*#*%%#*#*###***##*####%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@****#*#*#########%%#%%#%%%%%%%%%%%%%%%%*#%%%%%%\n\
				##%%*%%#%%%%#*####**###*#*#***###****###@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*##***%%##**###*%%######%%#%%#%%##%%*+%%%%\n\
				##%%*#####%%####*####*#*###*##*#+#*#*#@@@=@@@@@@@@@@@@@@@@@@@@@@@@%%##%%###*###**###*%%#%%#%%#%%%%%%%%%%##%%#*%%%%\n\
				%%#%%*%%%%%%%%#####%%*####*#*#***#*##+#*%%##@@@@@@@@@@@@@@@@@@@@@@@@@@@%%**#**#*#*####*#########%%#%%#%%#%%***%%%%\n\
				*%%%%*%%##%%#######*###*%%*#*#*####+#*###@@@@@@@@@@@@@@@@@@@@@@@@@@@%%***%%*#*###**###*########%%%%%%%%*%%%%**%%%%\n\
				##%%#%%%%%%%%++####*######*##%%**#**+#*#*%%@@@@@@@@@@@@@@@@@@@@@@@@@@@%%##*#***#*######*%%*####%%#%%%%#%%%%%%%%#%%%%%%\n\
				+*%%#%%##%%++#%%#%%+####*#####**#**+#*##%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@#####*###%%*###########%%#%%%%%%%%*%%%%##%%%%\n\
				++%%%%%%#%%%%*+#%%##+####*#*###*####*##%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%##*####%%##%%####*#%%%%%%#%%%%%%%%%%@%%#@@%%@\n\
				++%%%%%%%%%%%%*%%#%%##*#%%##*#*#######%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%*#####*##*###%%#%%###%%#%%%%@%%%%%%%%%%\n\
				%%%%%%%%%%#%%%%##*###*###%%*#*#*#%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%#####*#*##%%%%%%%%%%%%%%%%@%%###%%%%\n\
				%%%%%%#%%##%%**#%%#%%+#*##*##@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%#######%%%%%%%%%%%%%%%%%%#**%%%%\n\
				@%%%%%%%%%%%%%%####*####%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%#%%%%%%%%%%%%@@%%@@\n\
				@%%%%%%%%%%%%%%*##%%#%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#%%%%%%%%#%%%%%%%%@@\n\
				@%%@%%%%%%%%###@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#%%@@%%%%%%%%%%%%@@\n\n\
$(BLUE) ▄▄▄      ▄▄▄      ▓█████▄▓██   ██▓ ▄▄▄       ███▄    █        $(RED)██████  ▄▄▄        ██████  ██▓    ▄▄▄       ███▄    █▓██   ██▓ ▄▄▄      \n\
$(BLUE)▒████▄   ▒████▄    ▒██▀ ██▌▒██  ██▒▒████▄     ██ ▀█   █      $(RED)▒██    ▒ ▒████▄    ▒██    ▒ ▓██▒   ▒████▄     ██ ▀█   █ ▒██  ██▒▒████▄     \n\
$(BLUE)▒██  ▀█▄ ▒██  ▀█▄  ░██   █▌ ▒██ ██░▒██  ▀█▄  ▓██  ▀█ ██▒     $(RED)░ ▓██▄   ▒██  ▀█▄  ░ ▓██▄   ▒██░   ▒██  ▀█▄  ▓██  ▀█ ██▒ ▒██ ██░▒██  ▀█▄   \n\
$(BLUE)░██▄▄▄▄██░██▄▄▄▄██ ░▓█▄   ▌ ░ ▐██▓░░██▄▄▄▄██ ▓██▒  ▐▌██▒      $(RED) ▒   ██▒░██▄▄▄▄██   ▒   ██▒▒██░   ░██▄▄▄▄██ ▓██▒  ▐▌██▒ ░ ▐██▓░░██▄▄▄▄██ \n\
$(BLUE) ▓█   ▓██▒▓█   ▓██▒░▒████▓  ░ ██▒▓░ ▓█   ▓██▒▒██░   ▓██░     $(RED)▒██████▒▒ ▓█   ▓██▒▒██████▒▒░██████▒▓█   ▓██▒▒██░   ▓██░ ░ ██▒▓░ ▓█   ▓██▒\n\
$(BLUE) ▒▒   ▓▒█░▒▒   ▓▒█░ ▒▒▓  ▒   ██▒▒▒  ▒▒   ▓▒█░░ ▒░   ▒ ▒      $(RED)▒ ▒▓▒ ▒ ░ ▒▒   ▓▒█░▒ ▒▓▒ ▒ ░░ ▒░▓  ░▒▒   ▓▒█░░ ▒░   ▒ ▒   ██▒▒▒  ▒▒   ▓▒█░\n\
$(BLUE)  ▒   ▒▒ ░ ▒   ▒▒ ░ ░ ▒  ▒ ▓██ ░▒░   ▒   ▒▒ ░░ ░░   ░ ▒░     $(RED)░ ░▒  ░ ░  ▒   ▒▒ ░░ ░▒  ░ ░░ ░ ▒  ░ ▒   ▒▒ ░░ ░░   ░ ▒░▓██ ░▒░   ▒   ▒▒ ░\n\
$(BLUE)  ░   ▒    ░   ▒    ░ ░  ░ ▒ ▒ ░░    ░   ▒      ░   ░ ░      $(RED)░  ░  ░    ░   ▒   ░  ░  ░    ░ ░    ░   ▒      ░   ░ ░ ▒ ▒ ░░    ░   ▒   \n\
$(BLUE)      ░  ░     ░  ░   ░    ░ ░           ░  ░         ░      $(RED)      ░        ░  ░      ░      ░  ░     ░  ░         ░ ░ ░           ░  ░\n\
$(BLUE)                    ░      ░ ░                               $(RED)                                                        ░ ░               \n\
$(RESET)\n"


build:
	@mkdir -p $(BUILD_DIR)

lib:
	@make -C $(LIBFT_DIR)

clean:
	@rm -rf $(BUILD_DIR)
	@make -C $(LIBFT_DIR) clean
	@bash -c '\
		cols=$$(tput cols); \
		lines=10; \
		chars="01"; \
		for ((i=0; i<$$lines; i++)); do \
			line=""; \
			for ((j=0; j<$$cols; j++)); do \
				if (( RANDOM % 7 == 0 )); then \
					c=$${chars:RANDOM%$${#chars}:1}; \
					line+="$(RED)$$c"; \
				else \
					line+=" "; \
				fi; \
			done; \
			echo -e "$$line"; \
			sleep 0.015; \
		done'

fclean: clean
	@rm -f $(NAME)
	@make -C $(LIBFT_DIR) fclean
	@bash -c '\
		cols=$$(tput cols); \
		lines=10; \
		chars="01"; \
		for ((i=0; i<$$lines; i++)); do \
			line=""; \
			for ((j=0; j<$$cols; j++)); do \
				if (( RANDOM % 7 == 0 )); then \
					c=$${chars:RANDOM%$${#chars}:1}; \
					line+="$(RED)$$c"; \
				else \
					line+=" "; \
				fi; \
			done; \
			echo -e "$$line"; \
			sleep 0.015; \
		done'

re:	fclean all

.PHONY: all build lib clean fclean re
